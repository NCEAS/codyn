---
title: "Species turnover metrics"
author: ""
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
bibliography: biblio.bib
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
  
  
---

#Overview
Many measures of community structure, such as diversity indices and rank-abundance curves, represent “snapshots in time” – which poorly capture the temporal dynamics of ecological systems. For example, species richness (i.e., the number of species present) is a common metric to characterize ecological communities. However, species richness may be a poor indicator of community change if there is turnover in the identity but not the number of species present over time [@Collins2008; @cleland2013]. Similarly, species rank abundances can reorder through time, even when the pool of species present remains relatively stable. Within-year rank abundance curves fail to capture this dynamic, and other tools are needed to quantify within-community reordering without masking informative temporal shifts in internal dynamics [@Collins2008]. `codyn` includes three functions to characterize temporal shifts in species identity and rank abundances over time:

- **`turnover`** calculates total turnover as well as the proportion of species that either appear or disappear between timepoints.

- **`rankshift`** quantifies relative changes in species rank abundances by taking the sum difference of species ranks in consecutive timepoints. 
This metric goes hand-in-hand "rank clocks," a useful visualization tool of shifts in species ranks. 

- **`rate_change`** analyzes differences in species composition between samples at increasing time lags. It reflects the rate of directional change in community composition. 


```{r results='asis'}
library(codyn)
library(knitr)
library(plyr)
library(ggplot2)
```

# Example dataset
To illustrate each function, we use a dataset of plant composition from the Konza Prairie Long-term Ecological Research site in Manhattan, KS. The KNZ dataset spans 24 years and includes 20 replicate subplots.

```{r results='asis'}
KNZ <- read.csv(system.file("extdata", "knz_001d.csv", package="codyn"), sep=",", header=TRUE)
kable(head(KNZ))
```

#Turnover
##Total turnover
The function `turnover` calculates three metrics of species turnover: total turnover, appearances, and disappearances.
[Also include proportional persistence? This is the number in common between time point t and t+1 scaled to the number of species in t+1 [@Collins2008]]

The default metric `turnover` refers to total turnover, which calculates the proportion of species that differ between timepoints as:

$$ turnover = \frac{Species gained + Species lost}{Total species observed in both timepoints} $$

The metric was introduced by MacArthur and Wilson (1963) and modified by Diamond (1969) to be expressed as a proportion in order to compare turnover between sites that differ in species richness.

`turnover` requires a dataframe with columns for species, year and abundance, and includes an argument to specify a column for spatial replicates.

```{r results='asis'}
    KNZ_turnover<-turnover(KNZ, replicate="subplot", species="species", year="year", abundance="abundance")
    kable(head(KNZ_turnover))
```


If there are no replicates in the dataset, specify `replicate=NA`. For example, we calculate turnover on a subset of the KNZ dataset that only includes one replicate subplot.
```{r results='asis'}
KNZ_A1<-subset(KNZ, subplot=="A_1")
KNZ_A1_turnover<-turnover(KNZ_A1, replicate=NA, species="species", year="year", abundance="abundance")
kable(head(KNZ_A1_turnover))
```

Note that if `replicate=NA` but the dataset in fact includes replicates, `turnover` will be calculated using all species present in a given year (i.e., it will return a site-level measure of turnover). For example, calculating turnover across the entire KNZ dataset yields different values than calculating turnover within each replicate subplot.

```{r results='asis'}
    KNZ_turnover_agg<-turnover(KNZ, replicate=NA, species="species", year="year", abundance="abundance")
    kable(head(KNZ_turnover_agg))
```

###Appearances and disapperances

Total turnover incorporates both species appearances and disappearances. 



As a point of comparison, we also calculate richness over time at Konza.
```{r results='asis'}
    KNZ_rich<-ddply(subset(KNZ, abundance>0), .(subplot, year), "nrow")
    names(KNZ_rich)[3]="richness"
    kable(head(KNZ_rich))
```

Richness remains relatively constant, whereas turnover values are dynamic and often high, suggesting frequent shifts in species identity.
```{r results='asis'}
    rich_turn<-merge(KNZ_turnover, KNZ_rich)
    kable(head(rich_turn))
ggplot(rich_turn, aes(x=year, y=richness, color=subplot)) + geom_point()
ggplot(rich_turn, aes(x=year, y=turnover, color=subplot)) + geom_point()
```



##Citations


