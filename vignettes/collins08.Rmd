---
title: "Rank shifts between species"
author: "Lauren M. Hallett"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
bibliography: biblio.bib
vignette: >
  %\VignetteIndexEntry{Rank shifts between species}
  %\VignetteEngine{knitr::rmarkdown}
  %\SweaveUTF8 
  %\VignetteEncoding{UTF-8}
  %\usepackage[utf8]{inputenc}
---

## Species rank orders often reshuffle over time

Species communities are temporally dynamic due to environmental drivers leading to reordering of species abundances over time. Quantifying within-community reordering is a means of evaluating community stability without masking informative temporal shifts in internal dynamics [@Collins2008]. 

## Rank clocks: visualizing species rank shifts

Rank clocks plot the rank order of abundance of each species over time in a circle (like a clock!), starting with a vertical axis at 12 o'clock. They are useful to visualize the degree to which species fluctuate over time [@Collins2008]. 

To illustrate, let's first generate some sample data:

```{r}
library(devtools)
#load_all()
library(codyn)
library(ggplot2)
library(reshape2)

## Generate some sample data 
x = 1977:2003
y1 = .3*sin(x) + rnorm(length(x), 0, .1) + -.05*x + 150
y2 = .2*sin(x) + rnorm(length(x), 0, .1) + -.01*x + 70
y3 = .2*sin(x) + rnorm(length(x), 0, .1) + .01*x + 30

## Reshape the data: year, variable (y1,y2,y3), value
dat = melt(data.frame(x, y1, y2, y3), "x")

```


A traditional, linear depiction of species rank shifts can be cluttered and visually confusing:
```{r}
ggplot(dat, aes(x,value,color=variable)) + geom_line()
```


In contrast, a rank clock visualization highlights differences in the stability of species:
```{r}
ggplot(dat, aes(x,value,color=variable)) + geom_line() + coord_polar() + theme_bw() 

```

## rankshifts: A function to quantify shifts in species rank order

This function quantifies relative changes in species rank abundances by taking the sum difference of species ranks of consecutive pairs of years. 


## Visualizing mean species rank shifts

```{r}
##reading in data from Konza
collins08 <- read.csv(system.file("extdata", "collins08.csv", package="codyn"), sep=",", header=TRUE)

##running mean rank shift function 
dat <- meanrankshift(df=collins08, replicate.var="replicate", time.var="year", species.var="species", abundance.var="abundance")
dat$year<-as.numeric(substr(dat$year_pair, 6,9))

##plotting
ggplot(dat, aes(year, MRS, color=replicate)) + geom_line() + theme_bw()

  
```

## Citations
